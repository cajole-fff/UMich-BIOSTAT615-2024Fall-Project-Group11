# Define source files and objects
SOURCES = metrics/metric_adjusted_rand_index.cpp metrics/metric_silhouette_score.cpp utils/util_dbscan_fit.cpp
TMP_DIR = tmp
OBJECTS = $(addprefix $(TMP_DIR)/, $(notdir $(SOURCES:.cpp=.o)))

# Include paths and compiler flags
PKG_CPPFLAGS = -I/usr/local/lib/R/site-library/Rcpp/include

# Ensure tmp directory exists
$(TMP_DIR):
	mkdir -p $(TMP_DIR)

# Build shared library
$(SHLIB): $(TMP_DIR) $(OBJECTS)
	$(CC) -o $@ $(OBJECTS) $(PKG_LIBS)

# Rule to compile .cpp files into .o files in the tmp directory
$(TMP_DIR)/%.o: src/metrics/%.cpp
	$(CXX) $(PKG_CPPFLAGS) $(PKG_CXXFLAGS) -c $< -o $@

$(TMP_DIR)/%.o: src/utils/%.cpp
	$(CXX) $(PKG_CPPFLAGS) $(PKG_CXXFLAGS) -c $< -o $@

# Clean temporary files manually (if needed)
clean:
	rm -rf $(TMP_DIR) $(SHLIB)
